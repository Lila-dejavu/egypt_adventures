<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦å®Œæˆç•«é¢</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        .test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            border: 2px solid #8b4513;
            border-radius: 8px;
            padding: 15px;
            z-index: 20000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .test-controls h3 {
            margin: 0 0 10px 0;
            color: #8b4513;
        }
        .test-controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px 12px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-controls button:hover {
            background: #27ae60;
        }
        .test-controls .info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="test-controls">
        <h3>ğŸ§ª æ¸¬è©¦æ§åˆ¶å°</h3>
        <button id="test-victory">é¡¯ç¤ºå®Œæˆç•«é¢</button>
        <button id="reset-playthrough">é‡ç½®å‘¨ç›®æ•¸</button>
        <button id="add-equipment">æ·»åŠ æ¸¬è©¦è£å‚™</button>
        <button id="show-info">é¡¯ç¤ºç•¶å‰ç‹€æ…‹</button>
        <div class="info">
            <p>ç•¶å‰å‘¨ç›®ï¼š<span id="current-playthrough">0</span></p>
            <p>è£å‚™æ•¸é‡ï¼š<span id="equipment-count">0</span></p>
        </div>
    </div>

    <div id="game-container">
        <div id="header-area">
            <h1>Egypt Adventures - å®Œæˆç•«é¢æ¸¬è©¦</h1>
        </div>
        <div id="main-area">
            <div id="game-output">
                <p>é€™æ˜¯æ¸¬è©¦é é¢ï¼Œç”¨ä¾†æ¸¬è©¦éŠæˆ²å®Œæˆç•«é¢å’Œæ–°å‘¨ç›®åŠŸèƒ½ã€‚</p>
                <p>é»æ“Šå³ä¸Šè§’çš„æŒ‰éˆ•ä¾†æ¸¬è©¦å„ç¨®åŠŸèƒ½ã€‚</p>
            </div>
        </div>
        
        <!-- Victory Panel (from main game) -->
        <div id="victory-panel" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:500px; max-width:90vw; background:linear-gradient(135deg, #f4e4c1 0%, #e8d4bc 100%); border:8px solid #8b4513; border-radius:15px; padding:30px; z-index:10000; box-shadow:0 20px 60px rgba(0,0,0,0.5), inset 0 3px 0 rgba(255,248,220,0.9);">
            <div style="text-align:center; margin-bottom:20px;">
                <h2 style="color:#8b4513; font-size:32px; text-shadow:2px 2px 4px rgba(218,165,32,0.5); margin:0 0 10px 0;" data-i18n="congratulations">ğŸ‰ æ­å–œé€šé—œï¼ğŸ‰</h2>
                <p style="color:#654321; font-size:18px; margin:10px 0;" data-i18n="victoryDescription">ä½ æˆåŠŸå¾æœäº†åŸƒåŠçš„æ²™æ¼ ï¼</p>
                <div id="victory-stats" style="background:rgba(139,69,19,0.1); padding:15px; border-radius:8px; margin:15px 0; text-align:left;"></div>
            </div>
            <div style="margin:20px 0;">
                <h3 style="color:#8b4513; margin-bottom:10px; text-align:center;" data-i18n="selectCarryOverEquipment">é¸æ“‡ä¸€ä»¶è£å‚™æ”œå¸¶è‡³ä¸‹ä¸€å‘¨ç›®ï¼š</h3>
                <div id="equipment-selection" style="max-height:300px; overflow-y:auto; background:rgba(255,255,255,0.5); padding:10px; border-radius:5px; border:2px solid #8b4513;"></div>
            </div>
            <div style="text-align:center; margin-top:20px;">
                <button id="start-new-game-plus" style="padding:12px 30px; font-size:18px; background:#2ecc71; color:white; border:3px solid #27ae60; border-radius:8px; cursor:pointer; font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,0.3); transition:all 0.3s;" data-i18n="startNewGamePlus">é–‹å§‹æ–°å‘¨ç›® â¤</button>
            </div>
        </div>
        <div id="victory-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999;"></div>
    </div>

    <script src="../i18n.js"></script>
    <script src="../js/core/GameState.js"></script>
    <script src="../js/core/Config.js"></script>
    <script src="../js/data.js"></script>
    <script src="../js/equipment.js"></script>
    <script src="../js/mixins/NewGamePlusMixin.js"></script>
    
    <script>
        // Mock showMessage function
        window.showMessage = function(msg) {
            const output = document.getElementById('game-output');
            if (output) {
                const p = document.createElement('p');
                p.textContent = msg;
                p.style.margin = '5px 0';
                output.appendChild(p);
                output.scrollTop = output.scrollHeight;
            }
            console.log(msg);
        };

        // Mock t function for i18n
        window.t = function(key) {
            const translations = {
                'congratulations': 'ğŸ‰ æ­å–œé€šé—œï¼ğŸ‰',
                'victoryDescription': 'ä½ æˆåŠŸå¾æœäº†åŸƒåŠçš„æ²™æ¼ ï¼',
                'selectCarryOverEquipment': 'é¸æ“‡ä¸€ä»¶è£å‚™æ”œå¸¶è‡³ä¸‹ä¸€å‘¨ç›®ï¼š',
                'startNewGamePlus': 'é–‹å§‹æ–°å‘¨ç›® â¤',
                'noEquipmentToCarry': 'ï¼ˆæ²’æœ‰å¯æ”œå¸¶çš„è£å‚™ï¼‰',
                'skipCarryOver': 'ä¸æ”œå¸¶è£å‚™',
                'gameCompleteStats': 'å®Œæˆçµ±è¨ˆ',
                'finalLevel': 'æœ€çµ‚ç­‰ç´š',
                'totalGold': 'ç´¯ç©é‡‘å¹£',
                'defeatedEnemies': 'æ“Šæ•—æ•µäºº',
                'completedMaps': 'å®Œæˆåœ°åœ–',
                'playthroughCount': 'å‘¨ç›®æ•¸'
            };
            return translations[key] || key;
        };

        // Create mock game object
        class MockGame {
            constructor() {
                this.player = {
                    level: 15,
                    gold: 5000,
                    equipment: {
                        weapon: {
                            name: 'é»ƒé‡‘æ³•æ–',
                            slot: 'weapon',
                            atk: 50,
                            rarity: 'legendary',
                            isPyramid: true,
                            affix: 'fire',
                            affixName: 'çƒˆç„°',
                            affixColor: '#ff4444'
                        },
                        armor: {
                            name: 'æ²™æ¼ è­·ç”²',
                            slot: 'armor',
                            def: 30,
                            rarity: 'epic'
                        },
                        amulet: {
                            name: 'ç¥ç§˜è­·ç¬¦',
                            slot: 'amulet',
                            max_hp_bonus: 100,
                            rarity: 'rare'
                        }
                    },
                    inventory: [
                        {
                            name: 'éµåŠ',
                            slot: 'weapon',
                            atk: 20,
                            rarity: 'common'
                        },
                        {
                            name: 'çš®ç”²',
                            slot: 'armor',
                            def: 15,
                            rarity: 'rare'
                        }
                    ]
                };
                this.difficulty = 3;
            }
        }

        // Apply mixins
        Object.assign(MockGame.prototype, EquipmentMixin);
        Object.assign(MockGame.prototype, NewGamePlusMixin);

        const game = new MockGame();
        window.game = game;

        // Update info display
        function updateInfo() {
            const playthrough = localStorage.getItem('egypt_playthroughs') || '0';
            document.getElementById('current-playthrough').textContent = playthrough;
            
            let equipCount = 0;
            if (game.player.equipment.weapon) equipCount++;
            if (game.player.equipment.armor) equipCount++;
            if (game.player.equipment.amulet) equipCount++;
            equipCount += game.player.inventory.filter(i => i.slot).length;
            document.getElementById('equipment-count').textContent = equipCount;
        }

        // Test buttons
        document.getElementById('test-victory').addEventListener('click', () => {
            showMessage('ğŸ® é¡¯ç¤ºå®Œæˆç•«é¢...');
            game.showVictoryScreen();
        });

        document.getElementById('reset-playthrough').addEventListener('click', () => {
            localStorage.setItem('egypt_playthroughs', '0');
            localStorage.removeItem('egypt_carryover_equipment');
            showMessage('ğŸ”„ å‘¨ç›®æ•¸å·²é‡ç½®ç‚º 0');
            updateInfo();
        });

        document.getElementById('add-equipment').addEventListener('click', () => {
            game.player.inventory.push({
                name: 'æ¸¬è©¦æ­¦å™¨',
                slot: 'weapon',
                atk: Math.floor(Math.random() * 50) + 10,
                rarity: ['common', 'rare', 'excellent', 'epic', 'legendary'][Math.floor(Math.random() * 5)]
            });
            showMessage('âœ¨ å·²æ·»åŠ æ¸¬è©¦è£å‚™åˆ°èƒŒåŒ…');
            updateInfo();
        });

        document.getElementById('show-info').addEventListener('click', () => {
            const playthrough = localStorage.getItem('egypt_playthroughs') || '0';
            const carryover = localStorage.getItem('egypt_carryover_equipment');
            showMessage(`ğŸ“Š ç•¶å‰å‘¨ç›®: ${playthrough}`);
            showMessage(`ğŸ“¦ æ”œå¸¶è£å‚™: ${carryover ? 'æœ‰' : 'ç„¡'}`);
            if (carryover) {
                try {
                    const item = JSON.parse(carryover);
                    showMessage(`  â””â”€ ${item.name} (${item.rarity})`);
                } catch (e) {
                    showMessage('  â””â”€ è§£æå¤±æ•—');
                }
            }
        });

        // Initialize
        updateInfo();
        showMessage('âœ… æ¸¬è©¦ç’°å¢ƒå·²å°±ç·’');
        showMessage('ğŸ’¡ æç¤ºï¼šé»æ“Šã€Œé¡¯ç¤ºå®Œæˆç•«é¢ã€ä¾†æ¸¬è©¦åŠŸèƒ½');
    </script>
</body>
</html>
